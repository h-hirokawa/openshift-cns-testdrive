= Red Hat Advanced Cluster SecurityによるKubernetesの脆弱性管理

== ワークショップの目的

このセッションは、ACSダッシュボードを使用してKubernetesの脆弱性を特定することに慣れることを目的としています。特定の脆弱性の特徴や、Kubernetesクラスタで効果的に制御を実装する方法について説明します。

This workshop will focus on the log4shell export. However, multiple applications will be deployed in this use case. If you have time in the end, please explore the interface to see if you can find more security features that may help your use cases.

このワークショップでは、log4shellのエクスポートに焦点を当てます。このユースケースでは、複数のアプリケーションが展開されます。最後に時間があれば、あなたのユースケースに役立つかもしれない、より多くのセキュリティ機能を見つけられるかどうか、インターフェイスを探索してください。

== Red Hat Advanced Cluster Security for Kubernetes Basics

Red Hat Advanced Cluster Security for Kubernetes の基本

Red Hat Advanced Cluster Security for Kubernetes (Red Hat Advanced Cluster Security or ACS for short) provides the tools and capabilities to address the security needs of a cloud-native development approach on Kubernetes.

Red Hat Advanced Cluster Security for Kubernetes (Red Hat Advanced Cluster Security または略して ACS) は、Kubernetes 上でのクラウドネイティブ開発アプローチのセキュリティーのニーズに対応するためのツールと機能を提供します。

The ACS solution offers visibility into the security of your cluster, vulnerability management, and security compliance through auditing, network segmentation awareness and configuration, security risk profiling, security-related configuration management, threat detection, and incident response. In addition, ACS grants an ability to pull the actions from that tooling deep into the application code development process through APIs.

ACSソリューションは、監査、ネットワークセグメンテーションのアウェアネスと設定、セキュリティリスクプロファイリング、セキュリティ関連の設定管理、脅威の検出、インシデント対応を通じて、クラスタのセキュリティに対する可視性、脆弱性管理、およびセキュリティコンプライアンスを提供します。さらに、ACSはAPIを通じて、ツールからのアクションをアプリケーションコード開発プロセスに組み込むことができます。

These security features represent any developer or administrator's primary work as they work across various environments, including multiple datacenters, private clouds, or public clouds that run Kubernetes clusters.

これらのセキュリティ機能は、複数のデータセンター、プライベートクラウド、Kubernetesクラスタを実行するパブリッククラウドなど、さまざまな環境にわたって作業する開発者や管理者の主要な作業となります。

=== ACS Features

ACS の機能

Using Red Hat Advanced Cluster Security for Kubernetes, you can gain comprehensive Kubernetes security that includes the following use cases:

Red Hat Advanced Cluster Security for Kubernetes を使用すると、以下のユースケースを含む包括的な Kubernetes セキュリティを獲得することができます。

* 可視性：イメージ、レジストリ、コンテナ、デプロイメント、およびランタイムの動作の全体像を確認できます。
* 脆弱性管理：ソフトウェア開発ライフサイクル全体にわたって、コンテナイメージとKubernetesの脆弱性を特定し、修正します。
* コンプライアンス：インタラクティブなダッシュボードとワンクリックの監査レポートにより、CISベンチマーク、NIST、PCI、HIPAAに対するシステムの監査を行うことができます。
* ネットワーク・セグメンテーション：既存の接続を可視化し、Kubernetesネイティブの制御を使用してより厳密なセグメンテーションを実施し、影響範囲を縮小します。
* リスクプロファイリング；Kubernetesの宣言型データのコンテキストを使用して、すべてのデプロイメントをリスクレベルごとにランク付けし、修復の優先順位付けを行います。
* 構成管理：DockerとKubernetesのベストプラクティスを適用して、環境を強化し、より安全で安定したアプリケーションを実現します。
* 脅威の検出：ルール、自動化された許可リスト、およびベースラインを使用して、実行中のアプリケーションの疑わしいアクティビティを正確に特定します。

* インシデントレスポンス：ビルドの失敗やデプロイのブロックから、Podの終了や攻撃の阻止まで、Kubernetesを使用してアクションを実行します。

* Visibility: See your entire landscape of images, registries, containers, deployments, and runtime behavior.
* Vulnerability Management: Identify and remediate vulnerabilities in container images and Kubernetes across the entire software development life cycle.
* Compliance: Audit your systems against CIS Benchmarks, NIST, PCI, and HIPAA, with interactive dashboards and one-click audit reports.
* Network Segmentation: Visualize existing connections and enforce tighter segmentation using Kubernetes-native controls to reduce your blast radius.
* Risk Profiling: See all your deployments ranked by risk level, using context from Kubernetes' declarative data, to prioritize remediation.
* Configuration Management: Apply best practices for Docker and Kubernetes to harden your environment for a more secure and stable application.
* Threat Detection: Use rules, automated allow lists, and baselining to identify suspicious activity in your running applications accurately.
Incident Response: Take action, from failing builds and blocking deployments to killing pods and thwarting attacks, using Kubernetes for enforcement.

=== ACS Architecture

ACSのアーキテクチャ

The ACS Platform installs as a set of pods in your Kubernetes or OpenShift cluster and includes the following components:

ACS Platformは、KubernetesまたはOpenShiftクラスターにPodのセットとしてインストールされ、以下のコンポーネントが含まれます。

image::images/acs-2.png[]

* https://docs.openshift.com/acs/architecture/acs-architecture.html#centralized-components_acs-architecture[Central]: [Centralized components] 

Central is the main component of Red Hat Advanced Cluster Security for Kubernetes, and it is installed as a Kubernetes deployment. It handles data persistence, API interactions, and user interface (Portal) access. You can use the same Central instance to secure multiple OpenShift Container Platform or Kubernetes clusters.

Central: [Centralized components] 
Centralは、Red Hat Advanced Cluster Security for Kubernetesのメインコンポーネントで、Kubernetesのデプロイメントとしてインストールされます。データの永続化、APIインタラクション、ユーザーインターフェース (ポータル) アクセスを処理します。同じCentralインスタンスを使用して、複数のOpenShift Container PlatformまたはKubernetesクラスタを保護することができます。

* https://docs.openshift.com/acs/architecture/acs-architecture.html#centralized-components_acs-architecture[Scanner]: [Centralized component] 


Red Hat Advanced Cluster Security for Kubernetes includes an image vulnerability scanning component called Scanner. It analyzes all image layers to check for known vulnerabilities from the Common Vulnerabilities and Exposures (CVEs) list. The Scanner also identifies vulnerabilities in package managers' packages and dependencies for multiple programming languages.

Scanner: [Centralized component]

Red Hat Advanced Cluster Security for Kubernetes には、Scanner と呼ばれるイメージ脆弱性スキャンコンポーネントが含まれています。これは、すべてのイメージレイヤーを分析し、CVE (Common Vulnerabilities and Exposures) リストから既知の脆弱性をチェックします。また、Scannerは、パッケージマネージャのパッケージや複数のプログラミング言語の依存関係にある脆弱性を特定します

* https://docs.openshift.com/acs/architecture/acs-architecture.html#per-cluster-components_acs-architecture[Sensor]: [1 x Per Cluster] 

Red Hat Advanced Cluster Security for Kubernetes uses the Sensor component to monitor Kubernetes and OpenShift Container Platform clusters. It handles interactions with the OpenShift Container Platform or Kubernetes API server for policy detection and enforcement, and it coordinates with Collector.

Sensor: [1 x Per Cluster] 

Red Hat Advanced Cluster Security for Kubernetes は Sensor コンポーネントを使用して、Kubernetes と OpenShift Container Platform クラスターを監視します。ポリシーの検出と施行のために OpenShift Container Platform または Kubernetes API サーバーとのやり取りを処理し、Collector と連携します。

* https://docs.openshift.com/acs/architecture/acs-architecture.html#per-cluster-components_acs-architecture[Admission controller]: [1 x Cluster] 

The admission controller prevents users from creating workloads that violate security policies in Red Hat Advanced Cluster Security for Kubernetes. [1 x Admission Controller]

Admission controller: [1 x Cluster] 

Admission controllerは、ユーザーが Red Hat Advanced Cluster Security for Kubernetes のセキュリティポリシーに違反するワークロードを作成できないようにします。[1 x Admission Controller]


* https://redhat-scholars.github.io/acs-workshop/acs-workshop/03-overview-acs.html#acs_architecture[Collector]: [1 x Node OCP/K8s Nodes] 

Collector collects and monitors information about container runtime and network activity. It then sends the collected information to Sensor.

Collector: [1 x Node OCP/K8s Nodes]
Collector は、コンテナランタイムとネットワークアクティビティに関する情報を収集し、監視します。その後、収集した情報をSensorに送信します。

|===
Scanner only scans those images not already scanned by other integrated vulnerability scanners. It means that if you have integrated Red Hat Advanced Cluster Security for Kubernetes with other vulnerability scanners, Scanner checks and uses the scanning results from the integrated Scanner if available.

Scanner は、他の統合された脆弱性スキャナによってまだスキャンされていないイメージのみをスキャンします。これは、Red Hat Advanced Cluster Security for Kubernetes を他の脆弱性スキャナーと統合している場合、Scanner は統合された Scanner からのスキャン結果があればそれを確認し使用することを意味します。
|===

== Workshop Setup

ワークショップのセットアップ

=== Deploying Demo Application Sources - MANDATORY

デモ用アプリケーションソースの配備

In order to have the applications and vulnerabilities necessary for the demo, we need to introduce a few vulnerable applications into the cluster.

The command below will clone the tutorial sources and set the *TUTORIAL_HOME* environment variable to point to the root directory of the tutorial and deploy the applications:

デモに必要なアプリケーションと脆弱性を用意するために、クラスタにいくつかの脆弱なアプリケーションを導入する必要があります。

以下のコマンドは、チュートリアルのソースをクローンし、チュートリアルのルートディレクトリを指すように *TUTORIAL_HOME* 環境変数を設定し、アプリケーションをデプロイします。

[source,bash,role="execute"]
----
git clone https://github.com/openshiftdemos/openshift-ops-workshops acs-workshop
export TUTORIAL_HOME="$(pwd)/acs-workshop"
kubectl apply -f $TUTORIAL_HOME/workshop/demo-apps/configuration --recursive
kubectl apply -f $TUTORIAL_HOME/workshop/demo-apps/ --recursive
----

|===
*NOTE* This command applies a plethora of manifests to your environment. The important part is that the deployments are up and running. The

*NOTE* このコマンドは、あなたの環境に多数のマニフェストを適用します。重要なのは、デプロイメントが稼働していることです。

Run the following command and ensure that the applications are up and running

以下のコマンドを実行し、アプリケーションが起動していることを確認します。

|===

[source,bash,role="execute"]
----
kubectl get deployments -l demo=acs -A
----

*Output*
```bash
NAMESPACE      NAME               READY   UP-TO-DATE   AVAILABLE   AGE
backend        api-server         1/1     1            1           0d
frontend       asset-cache        1/1     1            1           0d
log4shell      log4shell-app      3/3     3            3           0d
medical        reporting          1/1     1            1           0d
operations     jump-host          1/1     1            1           0d
payments       visa-processor     1/1     1            1           0d
spring4shell   spring4shell-app   3/3     3            3           0d
```

=== Accessing the ACS Dashboard

ACS ダッシュボードへのアクセス

The ACS password will be necessary to access the dashboard. The information to access the ACS dashboard is found on the main access page of the demo.

ダッシュボードにアクセスするためには、ACS のパスワードが必要になります。ACSダッシュボードにアクセスするための情報は、デモのメインアクセスページに記載されています。

|===
*NOTE* You will get a warning page that the webpage is not private. During setup, ACS can utilize your certification server to avoid these errors. 

ウェブページが非公開であることを示す警告ページが表示されます。セットアップ中、ACSはこれらのエラーを避けるために、認証サーバーを利用することができます。

It is also best practice to integrate the application with your authentication server. 

また、アプリケーションを認証サーバーと統合することがベストプラクティスです。

|===

image::images/webpage-warning.png[]

== Working in the ACS Dashboard

ACS ダッシュボードでの作業

When logging into ACS, you will be redirected to the dashboard's main view.

ACSにログインすると、ダッシュボードのメインビューにリダイレクトされます。

image::images/acs-4.png[]

This central view will display a high-level view of the information about the Kubernetes clusters. It is essential to understand the primary components to navigate it effectively.

このセントラルビューには、Kubernetesクラスタに関する情報のハイレベルなビューが表示されます。これを効果的にナビゲートするためには、主要なコンポーネントを理解することが不可欠です。

In the ACS Dashboard, we have three main sections:

ACS Dashboardでは、3つの主要なセクションがあります。

* The header
* The menu
* The information

=== Dashboard Header
ダッシュボードヘッダー

image::images/acs-5.png[]

The header contains the following (from left to right):

ヘッダーには、以下のものが含まれます（左から右へ）。

* The drop-down menu
* The search bar
* The roxctl CLI
* Light or dark mode
* Cluster status and problems
* Help bar
* User information

=== Dashboard Left Menu

ダッシュボード左側のメニュー

image::images/acs-6.png[]

In the left part of the dashboard, we can see the different sections we can access in ACS to gather information about the security in the clusters we have configured in ACS. Later we will go deeper into a few of them. For the time being, we will introduce each of these:

* Dashboard: where we are at this moment. We can get a summary vision of our environment.
* Network Graph: we can get information about the configured network flows and the real ones. We can use it to create Network Policies to implement network segmentation.
* Violations: we can get all the events that do not match the defined security policies.
* Compliance: we can get compliance with our environment according to several industries and regulatory security standards such as PCI DSS.
* Vulnerability Management: get information about known vulnerabilities affecting your environment. Not only deployed workloads but infrastructure as well.
* Configuration Management: review configuration to prevent possible misconfigurations which can lead to security issues.
* Risk: review risks affecting your environment, such as suspicious executions.
* Platform Configuration: ACS configuration and integrations.

ダッシュボードの左側には、ACSで構成したクラスタのセキュリティに関する情報を収集するためにアクセスできるさまざまなセクションが表示されます。後ほど、そのうちのいくつかを深く掘り下げていきます。それぞれを簡単に紹介します。

* Dashboard：現在地。環境の概要を把握することができます。
* Network Graph：設定されたネットワーク・フローと実際のフローについての情報を得ることができます。これを使用してネットワークポリシーを作成し、ネットワークのセグメンテーションを行うことができます。
* Violations：定義されたセキュリティポリシーに一致しないすべてのイベントを取得することができます。
* Compliance：業界やPCI DSSなどのセキュリティ標準に準拠した環境でのコンプライアンスを取得することができます。
* Vulnerability Management：環境に影響を与える既知の脆弱性についての情報を得ることができます。配備されたワークロードだけでなく、インフラストラクチャも対象となります。
* Configuration Management：構成を見直し、セキュリティ問題につながる可能性のある誤構成を防止します。
* Risk：不審な実行など、環境に影響を及ぼすリスクを確認します。
* Platform Configuration。ACSの設定と統合


|===
*NOTE:* Please explore the application if you have time between the sessions. Some extra containers and apps are deployed in the cluster if you wish to find more vulnerabilities and policy violations.

セッションの間に時間があれば、アプリケーションを探索してください。より多くの脆弱性やポリシー違反を見つけたい場合のために、いくつかの余分なコンテナやアプリがクラスタに展開されています。

|===

=== Dashboard Information

ダッシュボード情報

The main dashboard gives us a summary of the security state of the whole environment. 

メインダッシュボードでは、環境全体のセキュリティ状態の概要を確認することができます。

image::images/acs-7.png[]

Including information by:

* Cluster
* Node
* Violation
* Deployments
* Images 
* Secrets

image::images/acs-8.png[]

Each tab at the top can be clicked to see more. 

上部の各タブは、クリックすることで詳細を見ることができます。

|===
If you have extra time, alter and click through the individual dashboard panels. They will take you to other sections of the ACS dashboard with the filters already applied. 

時間に余裕がある場合は、ダッシュボードの各パネルを変更し、クリックしてください。フィルターが既に適用されている状態で、ACSダッシュボードの他のセクションに移動します。
|===

== Vulnerability Management Dashboard

脆弱性管理ダッシュボード

Let us start with Vulnerability Management, a familiar topic for most security teams. Click the *Vulnerability Management* tab, and then select *Dashboard*

まず、ほとんどのセキュリティチームにとって身近なトピックである「脆弱性管理」から説明します。*Vulnerability Management* タブをクリックし、*Dashboard* を選択します。

image::images/vuln-1.png[]

The overview provides several important reports - where the vulnerabilities are, the most widespread or the most recent, where Docker images are coming from, and important vulnerabilities in the cluster itself.

概要では、脆弱性がどこにあるのか、広範囲に及んでいるのか、あるいは最新のものなのか、Dockerイメージはどこから来ているのか、そしてクラスタ自体の重要な脆弱性など、いくつかの重要なレポートが提供されます。

|===
*NOTE:* the locations and size of your panels may vary depending on your screen size and zoom. The pictures below will help to highlight the specific panels.

パネルの位置と大きさは、画面の大きさやズームによって異なる場合があります。以下の画像は、特定のパネルを強調するのに役立ちます。
|===

image::images/vuln-2.png[]

More important than fixing any vulnerability is establishing a process to keep container images updated and to prevent the promotion through the pipeline for images with serious, fixable vulnerabilities. ACS displays this through the *Top Risky Deployments by CVE and CVSS Score*. ACS takes the container's configuration and vulnerability details to show you the most *at risk* deployments in your cluster.

脆弱性の修正よりも重要なのは、コンテナイメージを常に更新し、深刻で修正可能な脆弱性を持つイメージのパイプラインによる昇格を防止する、プロセスを確立することです。ACSは、*CVEとCVSSスコアによるTop Risky Deployments* を通じてこれを表示します。ACSは、コンテナの構成と脆弱性の詳細を取得し、クラスタ内で *最も危険な* デプロイメントを表示します。


image::images/vuln-3.png[]

Above the *Risky Deployment* section, there are buttons to link you to all policies, CVEs, and images, and a menu to bring you to reports by cluster, namespace, deployment, and component. The vulnerability dashboard can be filtered by clicking the *Fixable CVSS* score button.

*Risky Deployment* セクションの上には、すべてのポリシー、CVE、イメージにリンクするボタンがあり、クラスタ、ネームスペース、デプロイメント、コンポーネントごとにレポートを表示するメニューがあります。脆弱性ダッシュボードは、*Fixable CVSS* スコアボタンをクリックすることでフィルタリングすることができます。

image::images/vuln-4.png[]

Locate the *Top Riskiest Images* panel. Here you can see the CVEs associated with containers currently running in the cluster. The goal is to find the log4shell exploit in your cluster and block that container from being pushed in the future.

*Top Riskiest Images* パネルを見つけます。ここでは、クラスタで現在実行されているコンテナに関連するCVEを見ることができます。目標は、クラスタ内のlog4shellエクスプロイトを見つけ、そのコンテナが今後プッシュされないようにブロックすることです。

image::images/vuln-5.png[]

* In the *Top Riskiest Images* panel, click on the *VIEW ALL* button. 

* *Top Riskiest Images* パネルで、*VIEW ALL* ボタンをクリックします。

|===
*NOTE:* For the following sections, please note that the order in which the images appear or the number of components affected may vary depending on versions and other applications running in the cluster.

以下のセクションでは、イメージの表示順や影響を受けるコンポーネントの数は、バージョンやクラスタで実行されている他のアプリケーションによって異なる場合があることに注意してください。
|===

=== Image Overview and Details

イメージの概要と詳細

Now you will see that the images are listed here in order of risk, based on the number and severity of the vulnerabilities present in the components in the images. 

ここで、イメージに含まれるコンポーネントに存在する脆弱性の数と深刻度に基づいて、リスクが高い順にリストアップされていることがわかります。

Take a look:

image::images/images-1.png[]

Notice which images are more exposed. Not only can we see the number of CVEs affecting the images, but which of them are fixable? 

We can also see:

どのイメージがより露出しているかに注目してください。イメージに影響を与えるCVEの数がわかるだけでなく、そのうちのどれが修正可能か？も見ることができます。

- Creation date
- Scan time 
- Image OS
- Image status
- How many deployments are using the vulnerable image
- The total components in the image

You can click and get information about the CVEs and which are fixable.

クリックすると、CVEとどれが修正可能かについての情報を得ることができます。

In the Top Riskiest Images, *find and click on* the image *visa-processor:latest-v2*. You will review the images' components and violations. 

Top Riskiest Imagesで、*visa-processor:latest-v2*　イメージを時つけてクリックします。 イメージのコンポーネントと違反を確認することができます。

image::images/images-2.png[]

|===
Note: If you cannot find the *visa-processor:latest-v2* image, use the search bar to filter for the specific image you want. 

*visa-processor:latest-v2*　イメージが見つからない場合は、検索バーを使用して、必要な特定のイメージをフィルタリングしてください。

If you click the search bar, you will be shown the different labels you can search by. Click *Image* and type visa until the correct image comes up. 

検索バーをクリックすると、検索可能なさまざまなラベルが表示されます。*Image* をクリックし、正しいイメージが表示されるまで visa と入力してください。

You can use this method of searching in all search bars within the ACS dashboard.

この検索方法は、ACSダッシュボード内のすべての検索バーで使用することができます。
|===

image::images/images-3.png[]

You can move on to the next section only when the dashboard displays the image below.

ダッシュボードに下のイメージが表示されて初めて、次のセクションに進むことができます。

image::images/images-4.png[]

==== ACS Vulnerability Scanner

ACS 脆弱性スキャナ

ACS' built-in vulnerability scanner breaks down images into layers and components - where components can be operating-system installed packages or dependencies installed by programming languages like Python, Javascript, or Java. The *Image Summary* provides the essential security details of the image overall, with links to the components. Below you can see why the image is ranked as a critically vulnerable application:

ACSの内蔵脆弱性スキャナは、イメージをレイヤーとコンポーネントに分解します。コンポーネントは、オペレーティングシステムにインストールされるパッケージや、Python、Javascript、Javaなどのプログラミング言語によってインストールされる依存関係であることがあります。*Image Summary* には、イメージ全体の重要なセキュリティの詳細と、コンポーネントへのリンクが記載されています。以下に、このイメージが致命的な脆弱性を持つアプリケーションとしてランク付けされた理由を示します。

* In the DETAILS & METADATA → Image OS panel, the information you see there tells you that this image has a severe security problem - the base image was imported several years ago (Debian 8 - 2015).

Image OSパネル、そこに表示される情報は、このイメージに深刻なセキュリティ問題があることを教えてくれます - ベースイメージは数年前（Debian 8 - 2015）にインポートされています。

* At the top of the page is the warning that CVE data is stale - that this image has a base OS version whose distribution has stopped providing security information and likely stopped publishing security fixes.

ページ上部には、「CVEデータは古く、このイメージのベースOSのバージョンは、配布元がセキュリティ情報の提供を停止し、セキュリティ修正プログラムの公開も停止している可能性が高い」という警告が表示されています。

* Scroll down the page. In the *Image Findings* section, you find the details of the image vulnerabilities. There are 329 fixable vulnerabilities in the cluster (at the time of the creation of this workshop.)

ページを下にスクロールしてください。*Image Findings* の中に、イメージの脆弱性の詳細が記載されています。クラスタ内の修正可能な脆弱性は332件です（本ワークショップ作成時点。）


image::images/risk-5.png[]

* Above the *Image Findings* section, click on the *Dockerfile* tab:

*Image Findings* セクションの上にある、*Dockerfile* タブをクリックします。

image::images/risk-6.png[]

The Dockerfile tab view shows the layer-by-layer view, and, as you can see, the most recent layers are also several years old. Time is not kind to images and components - as vulnerabilities are discovered, ACS will display newly discovered CVEs.

Dockerfileのタブビューではレイヤーごとに表示されますが、ご覧の通り、最新のレイヤーも数年前のものであることがわかります。イメージやコンポーネントに時間に関係ありません。脆弱性が発見されると、ACSは新しく発見されたCVEを表示します。

|===
It is not practical to ask your teams to fix Linux or Javascript - but we think it is reasonable to ask them to pick up fixes published by those communities.

LinuxやJavascriptの修正をチームに求めるのは現実的ではありませんが、それらのコミュニティが発表した修正をピックアップしてもらうのは合理的だと考えています。
|===    

=== log4shell CVE Vulnerability Analysis

log4shell CVE 脆弱性解析

It is time to find the components that have the log4shell vulnerability in your cluster.

クラスタ内でlog4shellの脆弱性を持つコンポーネントを見つけます。

* Head back to the *Top Riskiest Images* Dashboard

*Top Riskiest Images* Dashboardに戻ります。

* Search for the log4shell vulnerability using its CVE number (CVE-2021-44228)

 CVE番号（CVE-2021-44228）を用いてlog4shellの脆弱性を検索してください。

image::images/risk-7.png[]

* How many images are affected by the vulnerability?
* How many deployments contain the vulnerability?
* Why do you think the risk priority is where it is?
* Should the risk priority be higher? Or lower?

* 脆弱性の影響を受けるイメージはいくつありますか？
* その脆弱性を含むデプロイメントはいくつありますか？
* なぜリスクの優先順位が高いのでしょうか？
* リスクの優先順位はもっと高くあるべきですか？それとももっと低くすべきですか？

|===
The log4shell CVE is very serious - scoring 10/10 - and is fixable. 

log4shellのCVEは非常に深刻で、10/10のスコアで、修正可能です。
|===

Luckily there is only *ONE* image being affected by this vulnerability, so you could go directly to the source and fix all three deployments in one opportunity. 

幸いなことに、この脆弱性の影響を受けるイメージは *1つ* だけなので、ソースに直接アクセスして、3つのデプロイメントすべてを1回の機会で修正することが可能です。

== Relating Image CVEs with Kubernetes Configuration Properties

イメージのCVEとKubernetesの設定プロパティの関連性

All of this CVE detail is well and good, but it is a bit noisy. How do we judge the genuine risk - which vulnerabilities are likely to be exploited? Which vulnerabilities do we have to fix first?

このようなCVEの詳細な情報はすべて良いことなのですが、少し騒々しいのです。どの脆弱性が悪用される可能性が高いか？
どの脆弱性を先に修正する必要があるのか？といった、真のリスクはどのように判断すればよいのでしょうか？


ACS can use other sources of information in OpenShift to judge the risk that a given vulnerability would be exploited and set priorities for fixes.

ACSは、OpenShiftの他の情報源を利用して、ある脆弱性が悪用されるリスクを判断し、修正の優先順位を設定することができます。

The first risk factor - is the vulnerable component in a running deployment.

最初のリスク要因は、実行中のデプロイメントにおける脆弱なコンポーネントです。

* Click on the *Risk* panel to continue.

続けて、*Risk panel* をクリックします。

image::images/risk-1.png[]

Take a look at the total amount of deployments in the cluster. If you remember, the log4shell image was approximately 10 in terms of risks based on CVSS score and other CVEs.

クラスタ内のデプロイメントの総量を見てみましょう。log4shellのイメージは、CVSSスコアやその他のCVEに基づくリスクでは約10でした。


image::images/risk-2.png[]

So why is it down to #15 in this example?

では、なぜこの例では15位まで下がっているのでしょうか？

* Click on the log4shell deployment and review the risk indicators.

image::images/risk-3.png[]

* Next, click on the *visa-processor* deployment and review its risk indicators.

* 次に、*visa-processor* のデプロイメントをクリックし、そのリスク指標を確認します。


image::images/risk-4.png[]

What do you think made the *visa-processor* deployment #1 in this example?

この例で *visa-processor* 配置を 1位にしたのは何だと思いますか？

Factors that play into the overall score are in the risk indicators section. These include, but are not limited to:

総合得点に影響する要素は、リスク指標のセクションにあります。これには以下のものが含まれますが、これらに限定されるものではありません。

1. Policy Violations
2. Image Vulnerabilities
3. Service Configuration
4. Service Reachability
5. Components Useful for Attackers
6. Number of Components in an Image
7. Image Freshness
8. RBAC Configuration

1. ポリシー違反
2. イメージの脆弱性
3. サービス構成
4. サービス到達性
5. 攻撃者にとって有用なコンポーネント
6. イメージに含まれる成分の数
7. イメージの鮮度
8. RBACの構成

A primary reason for the *visa-processor* deployment to be ranked so high is that it is an ancient image (older than the log4shell app). A good indicator of risk is that the older an image is, the more likely it will have a significant exploitable vulnerability.

*visa-processor* の配置が上位にランクされている主な理由は、古いイメージ（log4shellアプリより古い）であることです。リスクの良い指標として、イメージが古ければ古いほど、悪用可能な重大な脆弱性を持っている可能性が高くなります。

|===
We will leave it to you to make risk assessments in the future. Let us get to enforcing a log4shell policy and stopping future deployments containing the vulnerability.

log4shellのポリシーを適用し、脆弱性を含む今後のデプロイメントを停止することに着手しましょう。
|===

== ACS Policies

ACS has many built-in policies to detect activity related to attacker goals: gain a foothold, maintain a presence, move laterally, and exfiltrate data. The continuous runtime monitoring observes all container activity and will automatically respond to events with appropriate enforcement and notification. However, that would be missing out on an opportunity - ACS wants to go one step further, to take advantage of containers' ephemeral, immutable nature to improve security in a measurable way from now on.

ACSは、足がかりとなるもの、プレゼンスの維持、横方向への移動、データの流出といった攻撃者の目標に関連するアクティビティを検出するための多くのビルトインポリシーを備えています。継続的なランタイム監視は、すべてのコンテナ活動を観察し、イベントには自動的に適切な実施と通知で対応します。しかし、それではチャンスを逃してしまいます。ACSはさらに一歩進んで、コンテナのエフェメラルでイミュータブルな性質を利用し、測定可能な方法でセキュリティを向上させたいと考えています。

We want to use runtime incidents and vulnerabilities as a learning opportunity to improve security going forward by constraining how our containers can act.

ランタイムインシデントや脆弱性を学習の機会として活用し、コンテナがどのように行動できるかを制約することで、今後のセキュリティを向上させたいと考えています。

We achieve this by creating policies and implementing them early in the CI/CD process.

そのためには、CI/CDプロセスの早い段階でポリシーを作成し、それを実装することで、それを完成します。

* On the left-hand side of the application, click the *Platform Configuration* tab and *select* *Policy Management*.

アプリケーションの左側で、*Platform Configuration* タブをクリックし、*Policy Management* を選択します。

image::images/policy-1.png[]

You can create policies based on rules and risks as well. Filter through the policies and find the *log4shell* policy.

ルールやリスクにも基づいてポリシーを作成することができます。ポリシーをフィルタリングして、*log4shell* ポリシーを見つけます。

image::images/policy-2.png[]

Once you have found the vulnerability, *click* on it to learn more.

脆弱性が見つかったら、その脆弱性を *click* して詳細を確認してください。


image::images/policy-3.png[]

If you click the actions button, you will see how easy it is to edit, clone, export or disable these policies. We also recommended cloning the policies and adding or removing specific filters as you need them. 

アクションボタンをクリックすると、これらのポリシーの編集、クローン、エクスポート、無効化が簡単に行えるのがわかります。また、ポリシーのクローンを作成し、必要に応じて特定のフィルタを追加または削除することをお勧めします。

== Homework

ホームワーク

If you have time, try cloning the log4shell policy and altering it to target a vulnerability of your choice. Go to the violations page and see if vulnerable applications have triggered your new policy. 

もし時間があれば、log4shell ポリシーをクローンし、任意の脆弱性をターゲットに変更することを試してみてください。violationsのページで、脆弱なアプリケーションが新しいポリシーをトリガーしたかどうかを確認します。
